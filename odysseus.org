#+TITLE: ttybitnik/emacs.d
#+AUTHOR: Vinicius Moraes
#+EMAIL: vinicius.moraes@eternodevir.com
#+OPTIONS: num:nil

#+html: <p align="center"><img src="img/emacs-demo.gif" /></p>

This is my personal *GNU Emacs* configuration. The main configuration file is an =.org= file named after /Odysseus/, which is loaded through =init.el=. As you may have noticed, this is the configuration itself due to *org-mode* literate programming capabilities.

**** Table of contents                                             :TOC_4:
  - [[#features][Features]]
  - [[#dependencies][Dependencies]]
  - [[#odysseus][Odysseus]]
    - [[#dashboard-screen][Dashboard screen]]
    - [[#display][Display]]
    - [[#theme-customization][Theme customization]]
    - [[#modeline][Modeline]]
    - [[#moving-around-emacs][Moving around Emacs]]
    - [[#text-manipulation][Text manipulation]]
    - [[#minor-conveniences][Minor conveniences]]
    - [[#functionality][Functionality]]
    - [[#programming][Programming]]
      - [[#cc][c/c++]]
      - [[#go][go]]
      - [[#rust][rust]]
      - [[#python][python]]
      - [[#shellbash][shell/bash]]
      - [[#lispelisp][lisp/elisp]]
      - [[#javascripttypescript][javascript/typescript]]
      - [[#html][html]]
      - [[#cssscss][css/scss]]
      - [[#json][json]]
      - [[#yaml][yaml]]
      - [[#toml][toml]]
      - [[#xml][xml]]
      - [[#sql][sql]]
      - [[#ansible][ansible]]
      - [[#dotplantuml][dot/plantuml]]
      - [[#markdown][markdown]]
    - [[#org][Org]]
      - [[#zettelkasten][Zettelkasten]]
      - [[#audiovisual][Audiovisual]]
    - [[#git-integration][Git integration]]
    - [[#remote-editing][Remote editing]]
    - [[#blog][Blog]]
    - [[#writing][Writing]]
    - [[#modeling][Modeling]]
    - [[#translation][Translation]]
    - [[#emailing][Emailing]]
    - [[#instant-messaging][Instant messaging]]
    - [[#diminish][Diminish]]
  - [[#license][License]]

** Features

The current configuration focuses on:

- Coding
- Note-taking
- Writing
- Translation
- Knowledge Management
- Academic Research
- Remote Server Administration
- Blogging
- Emailing
- IRC
  
/Contact me if you'd like to suggest a package. I'm always glad to learn about new ones./

** Dependencies

- packages
  - ripgrep pcre2 (org-roam)
  - graphviz (plantuml)
  - plantuml or java-openjdk (plantuml)
  - hunspell (flyspell)
  - nodejs-bash-language-server (bash)
  - sbcl (lisp)
  - clangd (c/c++)
- go
  - golps (go)
  - goimport (go)
  - sqls (sql)
- pip
  - pyright (python)
- npm
  - typescript-language-server (javascript)
  - typescript (javascript)
  - vscode-langservers-extracted (html/css/json)
  - yaml-language-server (yaml)
  - ansible-language-server (ansible)
- cargo
  - taplo-cli (toml)
- lsp-install-server
  - xmlls/lsp4xml (xml)
- binary
  - rust-analyzer (rust)

** Odysseus
*** Dashboard screen
#+BEGIN_SRC emacs-lisp
  (setq inhibit-startup-message t)

  (use-package dashboard
    :ensure t
    :init
    (dashboard-setup-startup-hook)
    (add-hook 'dashboard-mode-hook 'variable-pitch-mode)
    :custom
    (dashboard-items '((recents . 5)
                       (projects . 5)
                       (bookmarks . 5)
                       (agenda . 5)))
    (dashboard-center-content t)
    (dashboard-set-file-icons t)
    (dashboard-banner-logo-title "Welcome back, ttybitnik!")
    (dashboard-agenda-sort-strategy '(time-up))
    (dashboard-agenda-prefix-format "%i %-12:c %s ")
    (dashboard-agenda-tags-format 'ignore)
    :bind
    ("C-c d" . dashboard-open))

  (use-package all-the-icons
    :ensure t)

  (use-package projectile
    :ensure t
    :init
    (projectile-mode 1)
    :bind
    ("C-c p" . projectile-command-map)
    ("<f5>" . projectile-compile-project))
#+END_SRC

*** Display
#+BEGIN_SRC emacs-lisp
  (custom-theme-set-faces
   'user
   '(variable-pitch ((t (:family "Iosevka Aile"))))
   '(fixed-pitch ((t ( :family "Iosevka  Medium"))))
   '(org-block ((t (:inherit fixed-pitch))))
   '(org-code ((t (:inherit (shadow fixed-pitch)))))
   '(org-table ((t (:inherit fixed-pitch))))
   '(org-indent ((t (:inherit (org-hide fixed-pitch))))))

  (use-package gruvbox-theme
    :ensure t
    :config
    (load-file "~/.emacs.d/local/switcher.el"))

  (use-package all-the-icons-dired
      :ensure t
      :diminish all-the-icons-dired-mode)

  (setq visible-bell t)

  (when (display-graphic-p)
    (tool-bar-mode -1)
    (menu-bar-mode -1)
    (scroll-bar-mode -1)
    (fringe-mode 0))

  (setq locale-coding-system 'utf-8
        default-file-name-coding-system 'utf-8
        default-keyboard-coding-system 'utf-8
        default-process-coding-system '(utf-8 . utf-8)
        default-sendmail-coding-system 'utf-8
        default-terminal-coding-system 'utf-8)
  (prefer-coding-system 'utf-8)

  (if (display-graphic-p)
      (add-hook 'prog-mode-hook 'hl-line-mode))
#+END_SRC

*** Theme customization
#+BEGIN_SRC emacs-lisp
  (custom-set-faces
   '(fringe ((t (:background "burlywood4"))))

   '(org-level-1 ((t (:height 1.5))))
   '(org-level-2 ((t (:height 1.4))))
   '(org-level-3 ((t (:height 1.3))))
   '(org-level-4 ((t (:height 1.2))))
   '(org-level-5 ((t (:height 1.1))))
   '(org-level-6 ((t (:height 1.1))))
   '(org-level-7 ((t (:height 1.1))))
   '(org-level-8 ((t (:height 1.1))))
   '(dashboard-heading-face ((t (:inherit font-lock-keyword-face :height 1.1)))))

  (setq org-todo-keyword-faces
        '(("NEXT" . (:foreground "orange" :weight bold))
          ("WAITING" . (:foreground "yellow3" :weight bold))
          ("CANCELED" . (:foreground "gray" :weight bold))
          ("MEETING" . (:foreground "gold" :weight bold))
          ("DRAFT" . (:foreground "tomato" :weight bold))
          ("WRITING" . (:foreground "tomato" :weight bold))
          ("REVISION I" . (:foreground "tomato" :weight bold))
          ("REVISION II" . (:foreground "tomato" :weight bold))
          ("PROOFREADING" . (:foreground "tomato" :weight bold))))
#+END_SRC

*** Modeline
#+BEGIN_SRC emacs-lisp
  (use-package spaceline
    :ensure t
    :init
    (require 'spaceline-config)
    :custom
    (display-time-format "%H:%M - %d %B %Y")
    (display-time-mode 1)
    (powerline-default-separator 'wave)
    :config
    (spaceline-spacemacs-theme)
    (spaceline-helm-mode)
    (spaceline-info-mode)
    (add-hook 'emacs-startup-hook #'spaceline-toggle-line-column-on))
#+END_SRC

*** Moving around Emacs
#+BEGIN_SRC emacs-lisp
  ;; (use-package evil
  ;;   :ensure t)

  (setq scroll-conservatively 100)

  (use-package which-key
    :ensure t
    :diminish which-key-mode
    :config
    (which-key-mode)
    :custom
    (which-key-idle-delay 0.5))

  (use-package avy
    :ensure t
    :config
    (define-prefix-command 'avy-remap)
    (global-set-key (kbd "C-c M-s") 'avy-remap)
    (define-key avy-remap (kbd ".") 'isearch-forward-symbol-at-point)
    (define-key avy-remap (kbd "M-.") 'isearch-forward-thing-at-point)
    (define-key avy-remap (kbd "M-w") 'eww-search-words)
    (define-key avy-remap (kbd "_") 'isearch-forward-symbol)
    (define-key avy-remap (kbd "o") 'occur)
    (define-key avy-remap (kbd "g") 'grep)
    (define-key avy-remap (kbd "h .") 'highlight-symbol-at-point)
    (define-key avy-remap (kbd "h f") 'hi-lock-find-patterns)
    (define-key avy-remap (kbd "h l") 'highlight-lines-matching-regexp)
    (define-key avy-remap (kbd "h p") 'highlight-phrase)
    (define-key avy-remap (kbd "h r") 'highlight-regexp)
    (define-key avy-remap (kbd "h u") 'unhighlight-regexp)
    (define-key avy-remap (kbd "h w") 'hi-lock-write-interactive-patterns)
    :bind
    ("M-s" . avy-goto-char))

  (use-package switch-window
    :ensure t
    :bind*
    ([remap other-window] . switch-window)
    :custom
    (switch-window-input-style 'minibuffer)
    (switch-window-shortcut-style 'qwerty)
    (switch-window-increase 4)
    (switch-window-threshold 2)
    (switch-window-qwerty-shortcuts
     '("a" "s" "d" "f" "j" "k" "l" "i" "o")))


  (global-set-key (kbd "C-x b") 'ibuffer)
  ;; (setq ibuffer-expert t) ; only when used to ibuffer

  (use-package linum-relative
    :ensure t
    :diminish linum-relative-mode
    :custom
    (linum-relative-backend 'display-line-numbers-mode)
    :hook
    (prog-mode . linum-relative-mode)
    (conf-mode . linum-relative-mode))

  (use-package consult
    :ensure t
    :diminish consult-mode)

  (use-package helm
    :ensure t
    :diminish helm-mode
    :bind
    ("C-x C-f" . 'helm-find-files)
    ("C-x C-b" . 'helm-buffers-list)
    ("M-x" . 'helm-M-x)
    ("C-s" . helm-occur)
    (:map helm-find-files-map
          ("C-b" . helm-find-files-up-one-level)
          ("C-f" . helm-execute-persistent-action))
    :custom
    (helm-autoresize-max-height 0)
    (helm-autoresize-min-height 40)
    (helm-M-x-fuzzy-match t)
    (helm-buffers-fuzzy-matching t)
    (helm-recentf-fuzzy-match t)
    (helm-semantic-fuzzy-match t)
    (helm-imenu-fuzzy-match t)
    (helm-split-window-in-side-p nil)
    (helm-move-to-line-cycle-in-source nil)
    (helm-ff-search-library-in-sexp t)
    (helm-scroll-amount 8 )
    (helm-echo-input-in-header-line t)
    :init
    (helm-mode 1)
    (helm-autoresize-mode 1))

  (defun split-and-follow-horizontally ()
    (interactive)
    (split-window-below)
    (balance-windows)
    (other-window 1))
  (global-set-key (kbd "C-x 2") 'split-and-follow-horizontally)

  (defun split-and-follow-vertically ()
    (interactive)
    (split-window-right)
    (balance-windows)
    (other-window 1))
  (global-set-key (kbd "C-x 3") 'split-and-follow-vertically)

  (defun kill-current-buffer ()
    "Kills the current buffer."
    (interactive)
    (kill-buffer (current-buffer)))
  (global-set-key (kbd "C-x k") 'kill-current-buffer)

  (defun close-all-buffers ()
    "Kill all buffers without regard for their origin."
    (interactive)
    (mapc 'kill-buffer (buffer-list)))
  (global-set-key (kbd "C-M-s-k") 'close-all-buffers)

  (setq kill-buffer-query-functions (delq 'process-kill-buffer-query-function
                                          kill-buffer-query-functions))
  (defun previous-multilines ()
    "Scroll down multiple lines, `universal-argument' moves the `next-window'."
    (interactive)
    (if current-prefix-arg
        (with-selected-window (next-window)
          (ccm-scroll-down (/ (window-body-height) 3)))
      (ccm-scroll-down (/ (window-body-height) 3))))
  (global-set-key "\M-p" 'previous-multilines)

  (defun next-multilines ()
    "Scroll up multiple lines, `universal-argument' moves the `next-window'."
    (interactive)
    (if current-prefix-arg
        (with-selected-window (next-window)
          (ccm-scroll-up (/ (window-body-height) 3)))
      (ccm-scroll-up (/ (window-body-height) 3))))
  (global-set-key "\M-n" 'next-multilines)
#+END_SRC

*** Text manipulation
#+BEGIN_SRC emacs-lisp
  (use-package multiple-cursors
    :ensure t
    :bind
    ("C-S-c C-S-c" . 'mc/edit-lines)
    ("C->" . 'mc/mark-next-like-this)
    ("C-<" . 'mc/mark-previous-like-this)
    ("C-c q" . 'mc/mark-all-like-this))

  (use-package wgrep
    :ensure t
    :bind
    ("C-c C-e" . 'wgrep-change-to-wgrep-mode)
    ("C-c C-s p" . 'wgrep-apply-change)
    ("C-c C-s s" . 'wgrep-save-all-buffers))

  (defun kill-inner-word/daedreth ()
    "Kills the entire word your cursor is in. Equivalent to 'ciw' in vim."
    (interactive)
    (forward-char 1)
    (backward-word)
    (kill-word 1))
  (global-set-key (kbd "C-c w k") 'kill-inner-word/daedreth)

  (defun copy-whole-word/daedreth ()
    "Copies a word at the cursor position."
    (interactive)
    (save-excursion
      (forward-char 1)
      (backward-word)
      (kill-word 1)
      (yank)))
  (global-set-key (kbd "C-c w c") 'copy-whole-word/daedreth)

  (defun copy-whole-line/daedreth ()
    "Copies a line without regard for cursor position."
    (interactive)
    (save-excursion
      (kill-new
       (buffer-substring
        (point-at-bol)
        (point-at-eol)))))
  (global-set-key (kbd "C-c l c") 'copy-whole-line/daedreth)
  (global-set-key (kbd "C-c l k") 'kill-whole-line)
#+END_SRC

*** Minor conveniences
#+BEGIN_SRC emacs-lisp
  (defun config-visit ()
    "Opens ~/.emacs.d/odysseus.org"
    (interactive)
    (find-file "~/.emacs.d/odysseus.org"))
  (global-set-key (kbd "C-c e") 'config-visit)

  (defun config-reload ()
    "Reloads ~/.emacs.d/odysseus.org at runtime"
    (interactive)
    (org-babel-load-file (expand-file-name "~/.emacs.d/odysseus.org")))
  (global-set-key (kbd "C-c r") 'config-reload)

  (global-subword-mode 1)

  (electric-pair-mode t)

  (setq electric-pair-pairs '(
                              (?\{ . ?\})
                              (?\( . ?\))
                              (?\[ . ?\])
                              (?\" . ?\")))

  (use-package org-auto-tangle
    :ensure t
    :diminish org-auto-tangle-mode
    :defer t
    :hook
    (org-mode . org-auto-tangle-mode))

  (use-package beacon
    :ensure t
    :diminish beacon-mode
    :config
    (beacon-mode 1))

  (show-paren-mode 1)

  (use-package rainbow-mode
    :ensure t
    :diminish rainbow-mode
    :hook
    (prog-mode org-mode conf-mode))

  (use-package rainbow-delimiters
    :ensure t
    :diminish rainbow-delimiters-mode
    :init
    (add-hook 'prog-mode-hook #'rainbow-delimiters-mode))

  (use-package expand-region
    :ensure t
    :bind
    ("C-q" . er/expand-region))

  (use-package hungry-delete
    :ensure t
    :diminish hungry-delete-mode
    :config
    (global-hungry-delete-mode))

  (use-package zzz-to-char
    :ensure t
    :bind
    ("M-z" . zzz-to-char))

  (setq kill-ring-max 100)

  (use-package popup-kill-ring
    :ensure t
    :bind
    ("M-y" . popup-kill-ring))

  (use-package helm-descbinds
    :ensure t)

  (use-package olivetti
    :ensure t
    :diminish olivetti-mode
    :custom
    olivetti-body-width '140
    :bind
    ("C-c o" . olivetti-mode))

  (use-package centered-cursor-mode
    :ensure t
    :diminish centered-cursor-mode
    :init
    (global-centered-cursor-mode)
    (add-hook 'window-configuration-change-hook
              (lambda ()
                (unless (derived-mode-p 'erc-mode)
                  (recenter)))))
#+END_SRC

*** Functionality
#+BEGIN_SRC emacs-lisp
  ;; (setf epa-pinentry-mode 'loopback) disable pinentry inside Emacs
  (setq auth-sources '("~/.emacs.d/auth/.authinfo.gpg"))
  (load-file "~/.emacs.d/auth/.restrictconf.el")

  (setq make-backup-files nil)
  (setq backup-directory-alist '(("." . "~/.orpheus/gnu-emacs/saves/")))
  (setq auto-save-file-name-transforms '((".*" "~/.orpheus/gnu-emacs/saves/" t)))

  (transient-mark-mode 1);

  (server-start)

  ;; (global-auto-revert-mode 1) ; too resource intensive atm

  (defalias 'yes-or-no-p 'y-or-n-p)

  (use-package dired
    :config
    (require 'dired-x)
    :custom
    (dired-listing-switches "-alhvF --color=auto --group-directories-first")
    (dired-dwim-target t)
    (dired-guess-shell-alist-user
          '(("\\.\\(png\\|jpe?g\\|tiff\\)" "imv" "xdg-open")
            ("\\.\\(mp[34]\\|m4a\\|ogg\\|flac\\|webm\\|mkv\\)" "mpv" "xdg-open")
            (".*" "xdg-open")))
    (dired-create-destination-dirs 'ask)
    (dired-isearch-filenames 'dwim)
    (dired-vc-rename-file t)
    :hook
    (dired-mode . hl-line-mode)
    (dired-mode . all-the-icons-dired-mode))

  (use-package dired-subtree
    :ensure t
    :bind
    :custom
    (dired-subtree-use-backgrounds nil)
    (:map dired-mode-map
          ("<tab>" . dired-subtree-toggle)
          ("<backtab>" . dired-subtree-remove)))

  (use-package undo-tree
    :ensure t
    :diminish undo-tree-mode
    :custom
    (undo-tree-auto-save-history nil)
    :config
    (global-undo-tree-mode))

  (use-package async
    :ensure t
    :diminish dired-async-mode
    :init (dired-async-mode 1))

  (use-package company
    :ensure t
    :diminish company-mode
    :config
    ;; (company-tng-mode)
    :custom
    (company-global-modes #'(not eshell-mode))
    (company-idle-delay 0)
    (company-minimum-prefix-length 3)
    (company-tooltip-align-annotations t)
    (company-tooltip-flip-when-above t)
    (company-search-regexp-function #'company-search-flex-regexp)
    (company-dabbrev-ignore-case 'keep-prefix))

  (with-eval-after-load 'company
    (define-key company-active-map (kbd "<tab>")
      (defun fix-company-tab/ttybitnik ()
        "Fix `company-yasnippet' interaction with `yas-expand' command."
        (interactive)
        (when (null (yas-expand))
          (company-complete-common))))
    (define-key company-active-map (kbd "C-s") #'company-filter-candidates)
    (define-key company-active-map (kbd "C-M-s") #'company-search-candidates))

  (defun company-general/ttybitnik ()
    "Set up `company-mode' for general usage."
    (setq-local company-backends '((company-dabbrev
                                    company-file
                                    company-yasnippet))))

  (add-hook 'after-init-hook #'company-general/ttybitnik)
#+END_SRC

*** Programming
#+BEGIN_SRC emacs-lisp
  (add-hook 'prog-mode-hook #'fill-column/ttybitnik)
  (add-hook 'conf-mode-hook #'fill-column/ttybitnik)

  (use-package yasnippet
    :ensure t
    :config
    (use-package yasnippet-snippets :ensure t)
    (yas-reload-all))

  (use-package flycheck
    :ensure t
    :diminish flycheck-mode
    :custom
    (flycheck-idle-change-delay 2))

  (use-package lsp-mode
    :ensure t
    :init
    (setq lsp-keymap-prefix "C-c s")
    :hook
    (lsp-mode . lsp-enable-which-key-integration)
    :commands
    (lsp lsp-deferred))

  (use-package lsp-ui
    :ensure t
    :commands lsp-ui-mode)

  (use-package helm-lsp
    :ensure t
    :commands helm-lsp-workspace-symbol)

  (use-package consult-lsp
    :ensure t
    :config
    (define-key lsp-mode-map [remap xref-find-apropos] #'consult-lsp-symbols))

  ;  optinal packages that i'm not using atm
  ;; (use-package lsp-treemacs
  ;;   :ensure t
  ;;   :commands lsp-treemacs-errors-list)

  ;  if you want to use debugger, cf lsp doc
  ;; (use-package dap-mode)
  ;; (use-package dap-LANGUAGE) to load the dap adapter for your language

  (defun fill-column/ttybitnik (&optional value)
    "Set `fill-column' to VALUE or the default of 80, and enable
  `display-fill-column-indicator-mode'."
    (setq-local fill-column (if (numberp value) value 80))
    (display-fill-column-indicator-mode))
#+END_SRC

**** c/c++
#+BEGIN_SRC emacs-lisp
  (add-hook 'c-mode-hook (lambda ()
                           (yas-minor-mode)
                           (flycheck-mode)
                           (company-mode)
                           (lsp-deferred)
                           (company-c-mode/ttybitnik)))

  (use-package cc-mode)
  ;; debugger gdb or lldb, cf lsp doc

  (defun company-c-mode/ttybitnik ()
    "Set up `company-mode' for `c-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** go
#+BEGIN_SRC emacs-lisp
  (add-hook 'go-mode-hook (lambda ()
                            (yas-minor-mode)
                            (flycheck-mode)
                            (company-mode)
                            (lsp-deferred)
                            (company-go-mode/ttybitnik)))

  (use-package go-mode
    :ensure t
    :config
    (require 'lsp-go)
    (add-to-list 'exec-path "~/.go/bin/")
    :custom
    (lsp-go-analyses
     '((fieldalignment . t)
       (nilness . t)
       (shadow . t)
       (unusedwrite . t)
       (unusedparams . t)
       (unusedvariable . t)
       (useany . t)))
    (gofmt-command "goimports")
    :bind
    (:map go-mode-map
         ("<f6>" . gofmt)))

  (defun company-go-mode/ttybitnik ()
    "Set up `company-mode' for `go-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** rust
#+BEGIN_SRC emacs-lisp
  (add-hook 'rust-mode-hook (lambda ()
                            (yas-minor-mode)
                            (flycheck-mode)
                            (company-mode)
                            (lsp-deferred)
                            (company-rust-mode/ttybitnik)))

  (use-package rust-mode
    :ensure t)

  (defun company-rust-mode/ttybitnik ()
    "Set up `company-mode' for `rust-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** python
#+BEGIN_SRC emacs-lisp
  (add-hook 'python-mode-hook (lambda ()
                                (yas-minor-mode)
                                (flycheck-mode)
                                (company-mode)
                                (lsp-deferred)
                                (company-python-mode/ttybitnik)))

  (use-package python
    :custom
    (python-shell-interpreter "python3"))

  (use-package lsp-pyright
    :ensure t)

  (defun company-python-mode/ttybitnik ()
    "Set up `company-mode' for `python-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** shell/bash
#+BEGIN_SRC emacs-lisp
  (add-hook 'sh-mode-hook (lambda ()
                            (yas-minor-mode)
                            (flycheck-mode)
                            (company-mode)
                            (lsp-deferred)
                            (company-sh-mode/ttybitnik)))

  (use-package sh-script)

  (defun company-sh-mode/ttybitnik ()
    "Set up `company-mode' for `sh-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** lisp/elisp
#+BEGIN_SRC emacs-lisp
  (add-hook 'emacs-lisp-mode-hook (lambda ()
                                    (yas-minor-mode)
                                    ;; (flycheck-mode) ; useful when writing packages
                                    (company-mode)
                                    (company-lisp-mode/ttybitnik)
                                    (eldoc-mode)))

  (use-package lisp-mode)

  (use-package sly
    :ensure t
    :init
    (setq inferior-lisp-program "sbcl")
    (add-to-list 'sly-contribs 'sly-autodoc)
    (add-to-list 'sly-contribs 'sly-fancy))

  (defun company-lisp-mode/ttybitnik ()
    "Set up `company-mode' for `lisp-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** javascript/typescript
#+BEGIN_SRC emacs-lisp
  (add-hook 'js-mode-hook (lambda ()
                                      (yas-minor-mode)
                                      (flycheck-mode)
                                      (company-mode)
                                      (lsp-deferred)
                                      (company-js-mode/ttybitnik)))

  (use-package js)

  (use-package js2-mode
    :ensure t)

  (defun company-js-mode/ttybitnik ()
    "Set up `company-mode' for `js-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** html
#+BEGIN_SRC emacs-lisp
  (add-hook 'html-mode-hook (lambda ()
                            (yas-minor-mode)
                            (flycheck-mode)
                            (company-mode)
                            (lsp-deferred)
                            (company-html-mode/ttybitnik)))

  (use-package sgml-mode)

  (defun company-html-mode/ttybitnik ()
    "Set up `company-mode' for `html-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** css/scss
#+BEGIN_SRC emacs-lisp
  (add-hook 'css-mode-hook (lambda ()
                            (yas-minor-mode)
                            (flycheck-mode)
                            (company-mode)
                            (lsp-deferred)
                            (company-css-mode/ttybitnik)))

  (use-package css-mode)

  (defun company-css-mode/ttybitnik ()
    "Set up `company-mode' for `css-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** json
#+BEGIN_SRC emacs-lisp
  (add-hook 'json-mode-hook (lambda ()
                              (yas-minor-mode)
                              (flycheck-mode)
                              (company-mode)
                              (lsp-deferred)
                              (company-yaml-mode/ttybitnik)))

  (use-package json-mode
    :ensure t
    :config
    (require 'lsp-json))

  (defun company-json-mode/ttybitnik ()
    "Set up `company-mode' for `json-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** yaml
#+BEGIN_SRC emacs-lisp
  (add-hook 'yaml-mode-hook (lambda ()
                              (yas-minor-mode)
                              (flycheck-mode)
                              (company-mode)
                              (lsp-deferred)
                              (company-yaml-mode/ttybitnik)))

  (use-package yaml-mode
    :ensure t)

  (defun company-yaml-mode/ttybitnik ()
    "Set up `company-mode' for `yaml-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** toml
#+BEGIN_SRC emacs-lisp
  (add-hook 'conf-toml-mode-hook (lambda ()
                            (yas-minor-mode)
                            (flycheck-mode)
                            (company-mode)
                            (lsp-deferred)
                            (company-conf-toml-mode/ttybitnik)))

  (use-package conf-mode
    :custom
    (lsp-toml-command "~/.cargo/bin/taplo"))

  (defun company-conf-toml-mode/ttybitnik ()
    "Set up `company-mode' for `conf-toml-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** xml
#+BEGIN_SRC emacs-lisp
  (add-hook 'nxml-mode-hook (lambda ()
                            (yas-minor-mode)
                            (flycheck-mode)
                            (company-mode)
                            (lsp-deferred)
                            (company-nxml-mode/ttybitnik)))

  (use-package nxml-mode)

  (defun company-nxml-mode/ttybitnik ()
    "Set up `company-mode' for `nxml-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** sql
#+BEGIN_SRC emacs-lisp
  (add-hook 'sql-mode-hook (lambda ()
                            (yas-minor-mode)
                            (flycheck-mode)
                            (company-mode)
                            (lsp-deferred)
                            (company-sql-mode/ttybitnik)))

  (use-package sql)

  (defun company-sql-mode/ttybitnik ()
    "Set up `company-mode' for `sql-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** ansible
#+BEGIN_SRC emacs-lisp
  (add-hook 'ansible-hook (lambda ()
                            (yas-minor-mode)
                            (flycheck-mode)
                            (company-mode)
                            (lsp-deferred)
                            (company-ansible/ttybitnik)))

  (use-package ansible
    :ensure t
    :bind
    ("C-c C-S-a" . 'ansible))

  (defun company-ansible/ttybitnik ()
    "Set up `company-mode' for `ansible'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** dot/plantuml
#+BEGIN_SRC emacs-lisp
  (add-hook 'plantuml-mode-hook (lambda ()
                                  (yas-minor-mode)
                                  (flycheck-mode)
                                  (company-mode)
                                  (company-plantuml-mode/ttybitnik)))

  ;; cf Modeling

  (defun company-plantuml-mode/ttybitnik ()
    "Set up `company-mode' for `plantuml-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

**** markdown
#+BEGIN_SRC emacs-lisp
  (add-hook 'markdown-mode-hook (lambda ()
                                  (yas-minor-mode)
                                  (flycheck-mode)
                                  (company-mode)
                                  (company-markdown-mode/ttybitnik)))

  (use-package markdown-mode
    :ensure t)

  (defun company-markdown-mode/ttybitnik ()
    "Set up `company-mode' for `markdown-mode'."
    (setq-local company-minimum-prefix-length 1)
    (setq-local company-backends '((company-capf
                                    company-dabbrev-code
                                    company-keywords
                                    company-files
                                    company-yasnippet))))
#+END_SRC

*** Org
#+BEGIN_SRC emacs-lisp
  (use-package org
    :ensure t
    :pin gnu
    :custom
    (org-ellipsis " ")
    (org-use-speed-commands t)
    (org-src-fontify-natively t)
    (org-src-tab-acts-natively t)
    (org-confirm-babel-evaluate t)
    (org-babel-load-languages '((emacs-lisp . t)
                                (shell . t)
                                (python . t)
                                (C . t)
                                (plantuml . t)))
    (org-babel-python-command "python3")
    (org-export-with-smart-quotes t)
    (org-src-window-setup 'current-window)
    (org-todo-keywords '((sequence "TODO(t!)" "NEXT(n!)" "WAITING(h@/!)" "|" "MEETING(m!)" "DONE(d!)" "CANCELED(c@/!)")
                         (sequence "DRAFT(a!)" "WRITING(w!)" "REVISION I(r!)" "REVISION II(e!)" "PROOFREADING(o!)" "|" "PUBLISHED(p!)")))
    (org-agenda-start-with-log-mode t)
    (org-log-done 'time)
    (org-log-into-drawer t)
    (org-tag-alist '((:startgroup)
                     ("personal" . ?p)
                     ("work" . ?w)
                     ("study" . ?s)
                     (:endgroup)
                     ("autobiography" . ?a)
                     ("cinema" . ?c)
                     ("computing" . ?u)
                     ("reading" . ?r)
                     ("translation" . ?t)
                     ("music" . ?m)))
    (org-capture-templates
     '(("t" "Task" entry (file+headline "~/.orpheus/gnu-emacs/org-agenda/refile.org" "Tasks")
        (file "~/.emacs.d/local/org/task-template.org") :clock-in t :clock-resume t)
       ("m" "Meeting" entry (file+headline "~/.orpheus/gnu-emacs/org-agenda/refile.org" "Meetings")
        (file "~/.emacs.d/local/org/meeting-template.org") :clock-in t :clock-resume t)
       ("n" "Notes" entry (file+headline "~/.orpheus/gnu-emacs/org-agenda/refile.org" "Notes")
        (file "~/.emacs.d/local/org/note-template.org") :clock-in t :clock-resume t)
       ("j" "Journal" entry (file+olp+datetree "~/.orpheus/gnu-emacs/org-agenda/journal.org")
        (file "~/.emacs.d/local/org/journal-template.org") :clock-in t :clock-resume t)))
    (org-agenda-files '("~/.orpheus/gnu-emacs/org-agenda/"))
    (org-refile-targets '((nil :maxlevel . 1)
                          (org-agenda-files :maxlevel . 1)))
    :hook
    (org-mode . (lambda ()
                  (visual-line-mode 1)
                  (variable-pitch-mode 1)
                  (org-indent-mode 1)
                  (company-mode 1)
                  (yas-minor-mode 1)))
    :bind
    ("C-c '" . org-edit-src-code)
    ("C-c a" . org-agenda)
    ("C-c c" . org-capture))

  (use-package ox-twbs
    :ensure t)

  (use-package ox-reveal
    :ensure t
    :custom
    (org-reveal-root "https://cdn.jsdelivr.net/npm/reveal.js"))

  (use-package org-bullets
    :ensure t
    :custom
    (org-bullets-bullet-list '("‚óè"))
    :hook
    (org-mode . org-bullets-mode))

  (use-package htmlize
    :ensure t)

  (use-package toc-org
    :ensure t)

  (use-package pdf-tools
    :ensure t
    :diminish pdf-view-themed-minor-mode
    :init
    (pdf-loader-install)
    :hook
    (pdf-view-mode . pdf-view-themed-minor-mode)
    (pdf-view-mode . pdf-view-auto-slice-minor-mode))

  (use-package nov
    :ensure t
    :mode ("\\.\\(epub\\|mobi\\)\\'" . nov-mode))

  (use-package org-noter
    :ensure t
    ;; :requires (pdf-tools nov)
    :custom
    (org-noter-doc-split-fraction '(0.57 0.43))
    :bind
    ("C-c N" . org-noter))
#+END_SRC

**** Zettelkasten
#+BEGIN_SRC emacs-lisp
  (use-package org-roam
    :ensure t
    :custom
    (org-roam-directory (file-truename "~/.orpheus/gnu-emacs/org-roam/"))
    (org-roam-mode-sections (list #'org-roam-backlinks-section
                                  #'org-roam-reflinks-section
                                  #'org-roam-unlinked-references-section))
    (org-roam-capture-templates
     '(("p" "Project")
       ("pw" "Writing" plain (file "~/.emacs.d/local/org-roam/writing-template.org")
        :target (file "%<%Y%m%d%H%M%S>-writing-${slug}.org") :unnarrowed t :clock-in t :clock-resume t :jump-to-captured t :kill-buffer nil)
       ("pp" "Presenting" plain (file "~/.emacs.d/local/org-roam/presenting-template.org")
        :target (file "%<%Y%m%d%H%M%S>-presenting-${slug}.org") :unnarrowed t :clock-in t :clock-resume t :jump-to-captured t :kill-buffer nil)
       ("pb" "Blogging" plain (file "~/.emacs.d/local/org-roam/blogging-template.org")
        :target (file "%<%Y%m%d%H%M%S>-blogging-${slug}.org") :unnarrowed t :clock-in t :clock-resume t :jump-to-captured t :kill-buffer nil)

       ("c" "Capture")
       ("cb" "Book" plain (file "~/.emacs.d/local/org-roam/book-template.org")
        :target (file "ref/${citekey}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("cm" "Movie" plain (file "~/.emacs.d/local/org-roam/movie-template.org")
        :target (file "%<%Y%m%d%H%M%S>-movie-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("cu" "Music" plain (file "~/.emacs.d/local/org-roam/music-template.org")
        :target (file "%<%Y%m%d%H%M%S>-music-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("co" "Podcast" plain (file "~/.emacs.d/local/org-roam/podcast-template.org")
        :target (file "%<%Y%m%d%H%M%S>-podcast-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("cp" "Poem" plain (file "~/.emacs.d/local/org-roam/poem-template.org")
        :target (file "%<%Y%m%d%H%M%S>-poem-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("cq" "Quote" plain (file "~/.emacs.d/local/org-roam/quote-template.org")
        :target (file "%<%Y%m%d%H%M%S>-quote-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("ct" "Text" plain (file "~/.emacs.d/local/org-roam/text-template.org")
        :target (file "%<%Y%m%d%H%M%S>-text-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("ch" "Theatre" plain (file "~/.emacs.d/local/org-roam/theatre-template.org")
        :target (file "%<%Y%m%d%H%M%S>-theatre-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)

       ("n" "Note")
       ("nc" "Class" plain (file "~/.emacs.d/local/org-roam/class-template.org")
        :target (file "%<%Y%m%d%H%M%S>-class-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("no" "Convo" plain (file "~/.emacs.d/local/org-roam/convo-template.org")
        :target (fiLe "%<%Y%m%d%H%M%S>-convo-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("nu" "Course" plain (file "~/.emacs.d/local/org-roam/course-template.org")
        :target (file "%<%Y%m%d%H%M%S>-course-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("nd" "Dream" plain (file "~/.emacs.d/local/org-roam/dream-template.org")
        :target (file "%<%Y%m%d%H%M%S>-dream-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("ni" "Idea" plain (file "~/.emacs.d/local/org-roam/idea-template.org")
        :target (file "%<%Y%m%d%H%M%S>-idea-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("ns" "Sprint" plain (file "~/.emacs.d/local/org-roam/sprint-template.org")
        :target (file "%<%Y%m%d%H%M%S>-sprint-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("nz" "Zettel" plain (file "~/.emacs.d/local/org-roam/zettel-template.org")
        :target (file "%<%Y%m%d%H%M%S>-zettel-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)

       ("i" "Index" plain (file "~/.emacs.d/local/org-roam/index-template.org")
        :target (file "%<%Y%m%d%H%M%S>-index-${slug}.org") :unnarrowed t :clock-in t :clock-resume t)
       ("h" "Placeholder" entry "* ${title}\n%(org-id-get-create)"
        :target (file+head+olp
                 "~/.orpheus/gnu-emacs/org-roam/20230803215003-index-refile.org"
                 nil
                 ("Refile" "Placeholder"))
        :unnarrowed t :clock-in t :clock-resume t :immediate-finish t)))

    :config
    (org-roam-db-autosync-mode)
    (add-to-list 'display-buffer-alist
                 '("\\*org-roam\\*"
                   (display-buffer-in-direction)
                   (direction . right)
                   (window-width . 0.33)
                   (window-height . fit-window-to-buffer)))
    :hook
    (kill-emacs . org-roam-db-sync)
    :bind
    ("C-c n f" . 'org-roam-node-find)
    ("C-c n i" . 'org-roam-node-insert)
    ("C-c n r" . 'org-roam-ref-add)
    ("C-c n t" . 'org-roam-tag-add)
    ("C-c n c" . 'org-roam-capture)
    ("C-c n n" . org-roam-buffer-toggle)
    ("C-c n a" . org-roam-alias-add)
    ("C-c n s" . org-roam-db-sync))

  (use-package org-roam-ui
    :ensure t
    :diminish org-roam-ui-follow-mode
    :custom
    (org-roam-ui-sync-theme t)
    (org-roam-ui-follow t)
    (org-roam-ui-update-on-save t)
    (org-roam-ui-open-on-start t)
    :bind
    ("C-c n u" . org-roam-ui-mode)
    ("C-c n y" . org-roam-ui-sync-theme))

  (use-package bibtex
    :ensure t)

  (use-package org-roam-bibtex
    :ensure t
    :diminish org-roam-bibtex-mode
    :init
    (org-roam-bibtex-mode 1)
    :custom
    (orb-insert-interface 'helm-bibtex)
    (orb-autokey-format "%A%y")
    ;; (orb-preformat-keywords
    ;; '("citekey" "title" "url" "author-or-editor" "keywords" "file"))
    (orb-process-file-keyword t)
    (orb-attached-file-extensions '("pdf" "epub" "mobi"))) ;; experimental

  (use-package bibtex-completion
    :ensure t
    :custom
    (bibtex-completion-bibliography '("~/.prometheus/Bibliography/general.bib"))
    (bibtex-completion-library-path  '("~/.prometheus/Biblioteca/"))
    (bibtex-completion-notes-path "~/.orpheus/gnu-emacs/org-roam/ref/")

    (bibtex-completion-display-formats
     '((t . "${=has-pdf=:1}${=has-note=:1} ${year:4} ${author:25} ${title:*} ${tags:25} ${languages:6} ${custom_yesno:1} ${custom_fichamento:9} ${custom_organizer:10} ${custom_materia:25}")))

    (bibtex-completion-pdf-extension '(".pdf" ".epub" ".mobi")) ;; experimental
    ;; (bibtex-align-at-equal-sign t)
    ;; (bibtex-autokey-name-year-separator "")
    ;; (bibtex-autokey-year-title-separator "")
    ;; (bibtex-autokey-year-length 4)
    ;; (bibtex-autokey-titleword-first-ignore '("the" "a" "if" "and" "an"))
    ;; (bibtex-autokey-titleword-length 20)
    ;; (bibtex-autokey-titlewords-stretch 0)
    ;; (bibtex-autokey-titlewords 0)

    (bibtex-completion-pdf-field "file")
    (bibtex-completion-pdf-symbol "P")
    (bibtex-completion-notes-symbol "N")
    (bibtex-dialect 'biblatex)
    (bibtex-user-optional-fields '(("languages" "Languages")
                                   ("custom_fichamento" "Note-taking status")
                                   ("custom_organizer" "File type")
                                   ("custom_yesno" "Reading status")
                                   ("custom_materia" "Custom category")
                                   ("tags" "Personal tags")
                                   ("file" "Path to file")))

    (bibtex-completion-additional-search-fields '(tags custom_materia custom_yesno custom_organizer custom_fichamento languages))

    (bibtex-completion-format-citation-functions
     '((org-mode      . org-ref-helm-bibtex-insert-citation) ;; experimental
       (latex-mode    . bibtex-completion-format-citation-cite)
       (markdown-mode . bibtex-completion-format-citation-pandoc-citeproc)
       (default       . bibtex-completion-format-citation-default)))

    (bibtex-completion-cite-default-command "cite")
    (bibtex-completion-pdf-open-function 'helm-open-file-with-default-tool))

  (use-package helm-bibtex
    :ensure t
    :requires bibtex-completion
    ;; :custom
    ;; (bibtex-completion-notes-template-multiple-files
    ;;  "#+TITLE: ${=key=}\n#+CREATED: %U\n#+LAST_MODIFIED: %U\n\nLiterature notes for cite:${=key=}.\n\n")
    :bind
    ("C-c b b" . helm-bibtex)
    ("C-c b n" . helm-bibtex-with-notes)
    ("C-c b l" . helm-bibtex-with-local-bibliography))

  (use-package org-ref
    :ensure t
    :requires (org helm-bibtex)
    :bind
    ("C-c b c" . org-ref-cite-insert-helm))
#+END_SRC

**** Audiovisual
#+BEGIN_SRC emacs-lisp
  (use-package orgmdb
    :ensure t
    :custom
    (orgmdb-poster-folder "~/.orpheus/gnu-emacs/orgmdb"))

  (defun orgmdb-insert-media-data-string/ttybitnik (&rest args)
    "Return movie info and poster of given ARGS as a string.
    ARGS should be in the same form with `orgmdb' function."
    (let ((info (apply #'orgmdb `(,@args :episode all :plot full))))
      (orgmdb--ensure-response-is-successful info)
      (concat
       (format "* %s (%s) - %s\n" (orgmdb-title info) (orgmdb-year info) (orgmdb-imdb-link info))
       "\n"
       (format "[[file:%s]]\n\n" (orgmdb--download-image-for info))
       (format "- Genre :: %s\n" (orgmdb-genre info))
       (format "- Runtime :: %s\n" (orgmdb-runtime info))
       (format "- Released :: %s\n" (orgmdb-released info))
       (format "- Rated :: %s\n" (orgmdb-rated info))
       "\n"
       (format "- Director :: %s\n" (orgmdb-director info))
       (format "- Writer :: %s\n" (orgmdb-writer info))
       (format "- Production :: %s\n" (orgmdb-writer info))
       (format "- Actors :: %s\n" (orgmdb-actors info))
       "\n"
       (format "- Language :: %s\n" (orgmdb-language info))
       (format "- Country :: %s\n" (orgmdb-country info))
       (format "- Awards :: %s\n" (orgmdb-awards info))
       "\n"
       (format "- Metacritic :: %s\n" (orgmdb-metacritic info))
       (format "- IMDb Rating :: %s (%s votes)\n" (orgmdb-imdb-rating info) (orgmdb-imdb-votes info))
       (format "- Tomatometer :: %s\n" (orgmdb-tomatometer info))
       "\n"
       (format "- Plot :: %s\n" (orgmdb-plot info))
       (let ((last-season nil)
             (episode-strings '()))
         (seq-doseq (episode (alist-get 'Episodes info))
           (let-alist episode
             (let ((curr-season (string-to-number .Season)))
               (setq last-season (if (= curr-season last-season) last-season curr-season))
               (push (format "%s** [[imdb:%s][%s]]\n- IMDb Rating :: %s\n- Released :: %s\n"
                             (if (not (= curr-season last-season))
                                 (format "* Session %s\n" curr-season)
                               "")
                             .imdbID
                             (orgmdb--episode-to-title episode)
                             .imdbRating
                             .Released)
                     episode-strings))))
         (apply #'concat (reverse episode-strings))))))

  (defun orgmdb-insert-media-data/ttybitnik (&rest args)
    "Insert content containing movie info and poster of given ARGS.
    ARGS should be in the same form with `orgmdb' function.

    If this function is called on an org heading then it'll try to
    detect parameters based on that heading.  If not, it'll simply ask
    for title and year."
    (interactive (orgmdb--detect-params-from-header))
    (let ((info (apply #'orgmdb `(,@args :episode all :plot full))))
      (orgmdb--ensure-response-is-successful info)
      (insert (format "\n* %s (%s) - %s\n" (orgmdb-title info) (orgmdb-year info) (orgmdb-imdb-link info)))
      (insert "\n")
      (insert (format "[[file:%s]]\n\n" (orgmdb--download-image-for info)))
      (insert (format "- Genre :: %s\n" (orgmdb-genre info)))
      (insert (format "- Runtime :: %s\n" (orgmdb-runtime info)))
      (insert (format "- Released :: %s\n" (orgmdb-released info)))
      (insert (format "- Rated :: %s\n" (orgmdb-rated info)))
      (insert "\n")
      (insert (format "- Director :: %s\n" (orgmdb-director info)))
      (insert (format "- Writer :: %s\n" (orgmdb-writer info)))
      (insert (format "- Production :: %s\n" (orgmdb-writer info)))
      (insert (format "- Actors :: %s\n" (orgmdb-actors info)))
      (insert "\n")
      (insert (format "- Language :: %s\n" (orgmdb-language info)))
      (insert (format "- Country :: %s\n" (orgmdb-country info)))
      (insert (format "- Awards :: %s\n" (orgmdb-awards info)))
      (insert "\n")
      (insert (format "- Metacritic :: %s\n" (orgmdb-metacritic info)))
      (insert (format "- IMDb Rating :: %s (%s votes)\n" (orgmdb-imdb-rating info) (orgmdb-imdb-votes info)))
      (insert (format "- Tomatometer :: %s\n" (orgmdb-tomatometer info)))
      (insert "\n")
      (insert (format "- Plot :: %s\n" (orgmdb-plot info)))
      (insert "\n")
      (let (last-season)
        (seq-do
         (lambda (episode)
           (let-alist episode
             (let ((curr-season (string-to-number .Season)))
               (insert (format "%s** [[imdb:%s][%s]]\n"
                               (if (and last-season (eq curr-season last-season))
                                   ""
                                 (setq last-season curr-season)
                                 (format "* Session %s\n" curr-season))
                               .imdbID
                               (orgmdb--episode-to-title episode)))
               (insert (format "- IMDb Rating :: %s\n" .imdbRating))
               (insert (format "- Released :: %s\n" .Released)))))
         (alist-get 'Episodes info)))
      (org-display-inline-images)))
#+END_SRC

*** Git integration
#+BEGIN_SRC emacs-lisp
  (use-package magit
    :ensure t
    :config
    (setq magit-push-always-verify nil
          git-commit-summary-max-length 50)
    :bind
    ("M-g" . magit-status))

  (use-package exec-path-from-shell
    :ensure t
    :init
    (exec-path-from-shell-initialize)
    :custom
    (exec-path-from-shell-variables '("PATH" "MANPATH" "SSH_AUTH_SOCK")))
#+END_SRC

*** Remote editing
#+BEGIN_SRC emacs-lisp
  (setq tramp-default-method "ssh")

  (use-package sudo-edit
    :ensure t)
#+END_SRC

*** Blog
#+BEGIN_SRC emacs-lisp
  (use-package easy-hugo
    :ensure t
    :init
    (setq easy-hugo-postdir "content/blog"
          easy-hugo-basedir (concat (getenv "TTY_GITHUB") "/blog.backend")
          easy-hugo-url "https://ttybitnik.github.io"
          easy-hugo-sshdomain ""
          easy-hugo-root (concat (getenv "TTY_GITHUB") "/blog.backend/public")
          easy-hugo-previewtime "300"
          easy-hugo-default-ext ".org"
          easy-hugo-org-header t
          easy-hugo--sort-char-flg nil
          easy-hugo--sort-time-flg nil
          easy-hugo--sort-publishday-flg 1)
    :bind
    ("C-c h" . easy-hugo))
#+END_SRC

*** Writing
#+BEGIN_SRC emacs-lisp
  (use-package fountain-mode
    :ensure t)

  (use-package flyspell
    :diminish flyspell-mode
    :init
    (add-hook 'text-mode-hook 'flyspell-mode)
    (add-hook 'prog-mode-hook 'flyspell-prog-mode)
    :config
    (setenv "LANG" "en_US.UTF-8")
    (ispell-set-spellchecker-params)
    (ispell-hunspell-add-multi-dic "en_US,en_GB,pt_BR,de_DE,fr_FR")
    :custom
    (ispell-program-name "hunspell")
    (ispell-dictionary  "en_US,en_GB,pt_BR,de_DE,fr_FR")
    (ispell-personal-dictionary "~/.hunspell_personal")
    (flyspell-issue-message-flag nil))

  (unless (file-exists-p ispell-personal-dictionary)
    (write-region "" nil ispell-personal-dictionary nil 0))
#+END_SRC

*** Modeling
#+BEGIN_SRC emacs-lisp
  (use-package graphviz-dot-mode
    :ensure t
    :custom
    (graphviz-dot-indent-width 4))

  (use-package plantuml-mode
    :ensure t
    :custom
    (plantuml-default-exec-mode 'executable))
#+END_SRC

*** Translation
#+BEGIN_SRC emacs-lisp
  (use-package go-translate
    :ensure t
    :custom
    (gts-translate-list '(("pt-br" "en")
                          ("en" "de")
                          ("en""fr")))
    (gts-default-translator
     (gts-translator
      :picker (gts-noprompt-picker)
      :engines (list (gts-google-engine))
      :render (gts-buffer-render)))
    :bind
    ("C-c t" . gts-do-translate))
#+END_SRC

*** Emailing
#+BEGIN_SRC emacs-lisp
  (use-package gnus
    :ensure nil
    :custom
    (user-full-name "Vin√≠cius Moraes")
    (user-mail-address "vinicius.moraes@eternodevir.com")
    (message-signature "Vin√≠cius Moraes\neternodevir.com")
    (gnus-select-method '(nnimap "gmail"
                                    (nnimap-address "imap.gmail.com")
                                    (nnimap-server-port 993)
                                    (nnimap-stream ssl)
                                    (nnimap-authinfo-file "~/.emacs.d/auth/.authinfo.gpg")))
    (message-send-mail-function 'smtpmail-send-it)
    (smtpmail-smtp-server "smtp.gmail.com")
    (smtpmail-smtp-service 587)
    (gnus-secondary-select-methods '((nntp "news.gmane.io"))) ;; alt (nntp "news.gwene.org")
    ;; general
    (gnus-ignored-newsgroups "^to\\.\\|^[0-9. ]+\\( \\|$\\)\\|^[\"]\"[#'()]")
    (message-cite-reply-position 'below)
    (gnus-interactive-exit nil)
    (gnus-gcc-mark-as-read t)
    (gnus-agent t)
    ;; (gnus-novice-user nil)           ; careful with this
    (gnus-check-new-newsgroups 'ask-server)
    (gnus-read-active-file 'some)
    (gnus-agent-article-alist-save-format 1)  ; uncompressed
    (gnus-agent-cache t)
    (gnus-agent-confirmation-function 'y-or-n-p)
    (gnus-agent-consider-all-articles nil)
    (gnus-agent-directory "~/News/agent/")
    (gnus-agent-enable-expiration 'ENABLE)
    (gnus-agent-expire-days 30)
    (gnus-agent-mark-unread-after-downloaded t)
    (gnus-agent-queue-mail t)        ; queue if unplugged
    (gnus-agent-synchronize-flags nil)
    ;; group
    (gnus-group-sort-function
     '((gnus-group-sort-by-unread)
       (gnus-group-sort-by-alphabet)
       (gnus-group-sort-by-rank)))
    (gnus-group-line-format "%M%p%P%5y:%B%(%g%)\n")
    ;; (gnus-group-mode-line-format "%%b")
    ;; summary
    (gnus-auto-select-first nil)
    (gnus-summary-ignore-duplicates t)
    (gnus-suppress-duplicates t)
    (gnus-save-duplicate-list t)
    (gnus-summary-goto-unread nil)
    (gnus-summary-make-false-root 'adopt)
    (gnus-summary-thread-gathering-function
     'gnus-gather-threads-by-subject)
    (gnus-summary-gather-subject-limit 'fuzzy)
    (gnus-thread-sort-functions
     '((not gnus-thread-sort-by-date)
       (not gnus-thread-sort-by-number)))
    (gnus-subthread-sort-functions
     'gnus-thread-sort-by-date)
    (gnus-thread-hide-subtree nil)
    (gnus-thread-ignore-subject nil)
    (gnus-user-date-format-alist
     '(((gnus-seconds-today) . "Today at %R")
       ((+ (* 60 60 24) (gnus-seconds-today)) . "Yesterday, %R")
       (t . "%Y-%m-%d %R")))
    (gnus-summary-line-format "%U%R %-18,18&user-date; %-25,25f%4L   %B%S\n")
    ;; (gnus-summary-mode-line-format "[%U] %p")
    (gnus-sum-thread-tree-false-root "")
    (gnus-sum-thread-tree-indent " ")
    (gnus-sum-thread-tree-single-indent "")
    (gnus-sum-thread-tree-leaf-with-other "+-> ")
    (gnus-sum-thread-tree-root "")
    (gnus-sum-thread-tree-single-leaf "\\-> ")
    (gnus-sum-thread-tree-vertical "|")
    ;;; article
    (gnus-article-browse-delete-temp 'ask)
    (gnus-article-over-scroll nil)
    (gnus-article-show-cursor t)
    (gnus-article-sort-functions
     '((not gnus-article-sort-by-number)
       (not gnus-article-sort-by-date)))
    (gnus-article-truncate-lines nil)
    (gnus-html-frame-width 80)
    (gnus-html-image-automatic-caching t)
    (gnus-inhibit-images t)
    (gnus-max-image-proportion 0.7)
    (gnus-treat-display-smileys nil)
    ;; (gnus-article-mode-line-format "%G %S %m")
    (gnus-visible-headers
     '("^From:" "^To:" "^Cc:" "^Subject:" "^Newsgroups:" "^Date:"
       "Followup-To:" "Reply-To:" "^Organization:" "^X-Newsreader:"
       "^X-Mailer:"))
    (gnus-sorted-header-list gnus-visible-headers)
    (gnus-article-x-face-too-ugly ".*")
    :bind
    ("C-c g" . gnus)
    :hook
    (dired-mode . turn-on-gnus-dired-mode)
    (gnus-group-mode . gnus-topic-mode)
    (gnus-select-group . gnus-group-set-timestamp)
    (gnus-group-mode . hl-line-mode)
    (gnus-summary-mode . hl-line-mode)
    (gnus-browse-mode . hl-line-mode))

  ;; useful options currently disabled
  ;; (setq gnus-use-cache t)
  ;; (setq message-citation-line-function nil)
  ;; (setq message-ignored-cited-headers nil)

  (use-package epa-file
    :ensure nil
    :custom
    (mm-verify-option 'always)
    (mm-decrypt-option 'always)
    (mm-sign-option 'guided)
    :config
    (epa-file-enable))
#+END_SRC

*** Instant messaging
#+BEGIN_SRC emacs-lisp
  (use-package erc
    :custom
    (erc-server "irc.libera.chat")
    (erc-auto-query 'bury)
    (erc-join-buffer 'bury)
    (erc-kill-buffer-on-part t)
    (erc-kill-queries-on-quit t)
    (erc-kill-server-buffer-on-quit t)
    (erc-interpret-mirc-color t)
    (erc-rename-buffers t)
    (erc-lurker-hide-list '("JOIN" "PART" "QUIT"))
    (erc-track-exclude-types '("JOIN" "PART" "NICK" "MODE" "AWAY" "QUIT"
                               "324" "329" "332" "333" "353" "477"))
    (erc-track-enable-keybindings t)
    (erc-track-visibility nil)
    (erc-track-shorten-start 1)
    (erc-fill-column 100)
    (erc-fill-function 'erc-fill-static)
    (erc-fill-static-center 15)
    (erc-quit-reason (lambda (s) (or s "Fading out...")))
    (erc-modules '(autoaway autojoin button completion fill irccontrols keep-place list
                            match menu move-to-prompt netsplit networks noncommands readonly
                            ring stamp track hl-nicks scrolltobottom))
    :config
    (defun erc-login/ttybitnik ()
      "ERC libera.chat login with SASL."
      (interactive)
      (erc-tls :server "irc.libera.chat" :port "6697"))

    (defun erc-switch-buffer/ttybitnik (orig-fun &optional arg)
      "Advice function to move to the end of the buffer after `erc-track-switch-buffer'."
      (funcall orig-fun arg)
      (when (eq major-mode 'erc-mode)
        (end-of-buffer)))
    (advice-add 'erc-track-switch-buffer :around #'erc-switch-buffer/ttybitnik)
    :bind
    ("C-c i" . erc-login/ttybitnik))

  (use-package erc-hl-nicks
    :ensure t
    :after erc
    :config
    (erc-update-modules))

  ;; Require ERC-SASL package
  (require 'erc-services)
  (load-file "~/.emacs.d/local/erc-sasl.el")
  (require 'erc-sasl)

  (add-to-list 'erc-sasl-server-regexp-list "irc\\.libera\\.chat")

  (defun erc-login ()
    "Perform user authentication at the IRC server. (PATCHED)"
    (erc-log (format "login: nick: %s, user: %s %s %s :%s"
                     (erc-current-nick)
                     (user-login-name)
                     (or erc-system-name (system-name))
                     erc-session-server
                     erc-session-user-full-name))
    (if erc-session-password
        (erc-server-send (format "PASS %s" erc-session-password))
      (message "Logging in without password"))
    (when (and (featurep 'erc-sasl) (erc-sasl-use-sasl-p))
      (erc-server-send "CAP REQ :sasl"))
    (erc-server-send (format "NICK %s" (erc-current-nick)))
    (erc-server-send
     (format "USER %s %s %s :%s"
             (if erc-anonymous-login erc-email-userid (user-login-name))
             "0" "*"
             erc-session-user-full-name))
    (erc-update-mode-line))
#+END_SRC

*** Diminish
#+BEGIN_SRC emacs-lisp
  (use-package diminish
      :ensure t
      :diminish visual-line-mode
      :diminish subword-mode
      :diminish page-break-lines-mode
      :diminish yas-minor-mode
      :diminish eldoc-mode)

  (eval-after-load 'org-indent '(diminish 'org-indent-mode))
  (eval-after-load 'face-remap '(diminish 'buffer-face-mode))
  (eval-after-load 'autorevert '(diminish 'auto-revert-mode))
  (eval-after-load 'dashboard '(progn (dashboard-refresh-buffer)))
  #+END_SRC

** License

This project is licensed under the GNU General Public License v3.0 (GPL-3.0), unless an exception is made explicit in context. The GPL is a copyleft license that guarantees the freedom to use, modify, and distribute software. It ensures that users have control over the software they use and promotes collaboration and sharing of knowledge. By requiring that derivative works of GPL-licensed software also be licensed under the GPL, the license ensures that the freedoms it provides are extended to future generations of users and developers.

See the =LICENSE= file for more information.
